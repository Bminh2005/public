<div class="card card--table">
  <div class="card__header">
    <h2>Danh s√°ch H·ªô kh·∫©u</h2>
    <div class="card__actions">
      <input id="tableSearch" class="input" placeholder="T√¨m theo s·ªë h·ªô kh·∫©u / ch·ªß h·ªô / ƒë·ªãa ch·ªâ‚Ä¶" />
      <button id="openCreateHouseholdModal" class="btn btn--primary">‚ûï T·∫°o h·ªô kh·∫©u m·ªõi</button>
      <button id="exportCsv" class="ghost">‚¨á CSV</button>
    </div>
  </div>
  <div class="table-wrap">
    <table class="table" id="householdTable">
      <thead>
        <tr>
          <th data-key="soHK" tabindex="0">S·ªë h·ªô kh·∫©u</th>
          <th data-key="chuHo" tabindex="0">Ch·ªß h·ªô</th>
          <th data-key="diaChi" tabindex="0">ƒê·ªãa ch·ªâ</th>
          <th data-key="sl" tabindex="0">SL nh√¢n kh·∫©u</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="emptyState" class="empty hidden">Kh√¥ng c√≥ d·ªØ li·ªáu ph√π h·ª£p.</div>
  </div>
  <div class="table__footer">
    <button class="ghost" id="prevPage">‚Üê Tr∆∞·ªõc</button>
    <span id="pageInfo">Trang 1/1</span>
    <button class="ghost" id="nextPage">Sau ‚Üí</button>
  </div>
</div>

<!-- Modal: Household Detail -->
<div id="householdModal" class="modal">
  <div class="modal__overlay"></div>
  <div class="modal__content" style="max-width:900px;">
    <div class="modal__header">
      <h2 id="modalTitle">Chi ti·∫øt h·ªô kh·∫©u</h2>
      <button id="closeModal" class="modal__close" aria-label="ƒê√≥ng">√ó</button>
    </div>
    <div class="modal__body">
      <div class="household-info">
        <div class="info-row">
          <span class="label">S·ªë h·ªô kh·∫©u:</span>
          <span class="value" id="modalSoHK"></span>
        </div>
        <div class="info-row">
          <span class="label">Ch·ªß h·ªô:</span>
          <span class="value" id="modalChuHo"></span>
        </div>
        <div class="info-row">
          <span class="label">ƒê·ªãa ch·ªâ:</span>
          <span class="value" id="modalDiaChi"></span>
        </div>
      </div>

      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <button id="editHouseholdBtn" class="btn btn--primary">‚úé Ch·ªânh s·ª≠a</button>
      </div>

      <h3>Danh s√°ch nh√¢n kh·∫©u</h3>
      <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;">
        <button id="addMemberBtn" class="btn btn--primary" style="font-size:13px;">‚ûï Th√™m th√†nh vi√™n</button>
        <button id="removeMemberBtn" class="btn" style="font-size:13px;">üóë X√≥a th√†nh vi√™n ƒë∆∞·ª£c ch·ªçn</button>
        <button id="createHouseholdFromMembersBtn" class="btn"
          style="font-size:13px;background:#f59e0b;color:#fff;border-color:transparent;">üîÄ T·∫°o h·ªô kh·∫©u t·ª´ th√†nh vi√™n
          ch·ªçn</button>
      </div>
      <table class="table table--compact">
        <thead>
          <tr>
            <th style="width:40px;"><input type="checkbox" id="selectAllMembers" /></th>
            <th>STT</th>
            <th>H·ªç t√™n</th>
            <th>NƒÉm sinh</th>
            <th>Gi·ªõi t√≠nh</th>
            <th>Quan h·ªá v·ªõi ch·ªß h·ªô</th>
            <th>CCCD</th>
          </tr>
        </thead>
        <tbody id="modalTableBody"></tbody>
      </table>

      <h3 style="margin-top:24px;">üìã L·ªãch s·ª≠ thay ƒë·ªïi</h3>
      <div id="changeHistory"
        style="background:#f8fafc;border-radius:12px;padding:12px;max-height:200px;overflow-y:auto;font-size:13px;">
        <p style="color:var(--muted);margin:0;">Ch∆∞a c√≥ thay ƒë·ªïi</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Create Household -->
<div id="createHouseholdModal" class="modal">
  <div class="modal__overlay"></div>
  <div class="modal__content" style="max-width: 800px;">
    <div class="modal__header"
      style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); color: white; padding: 20px;">
      <h2 style="margin: 0; font-size: 18px;">üìã T·∫°o h·ªô kh·∫©u m·ªõi</h2>
      <button id="closeCreateModal" class="modal__close" aria-label="ƒê√≥ng"
        style="color: white; font-size: 24px;">√ó</button>
    </div>
    <div class="modal__body" style="padding: 24px; max-height: 600px; overflow-y: auto;">
      <form id="createHouseholdForm" class="form">
        <h3 style="font-size: 14px; margin: 0 0 12px 0; font-weight: 600;">üìã Th√¥ng tin ch·ªß h·ªô</h3>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="nhk_hoTen">H·ªç v√† t√™n *</label>
            <input id="nhk_hoTen" type="text" class="input" placeholder="Nh·∫≠p h·ªç v√† t√™n" required
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
          <div class="form__group">
            <label for="nhk_biDanh">B√≠ danh</label>
            <input id="nhk_biDanh" type="text" class="input" placeholder="Nh·∫≠p b√≠ danh"
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
        </div>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="nhk_ngaySinh">Ng√†y sinh *</label>
            <input id="nhk_ngaySinh" type="date" class="input" required
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
          <div class="form__group">
            <label for="nhk_danToc">D√¢n t·ªôc *</label>
            <input id="nhk_danToc" type="text" class="input" placeholder="Nh·∫≠p d√¢n t·ªôc" required
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
        </div>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="nhk_gioiTinh">Gi·ªõi t√≠nh *</label>
            <select id="nhk_gioiTinh" class="input" required style="padding: 10px 12px; border-radius: 6px;">
              <option value="">Ch·ªçn gi·ªõi t√≠nh</option>
              <option value="Nam">Nam</option>
              <option value="N·ªØ">N·ªØ</option>
            </select>
          </div>
          <div class="form__group">
            <label for="nhk_soCCCD">S·ªë CCCD *</label>
            <input id="nhk_soCCCD" type="text" class="input" placeholder="Nh·∫≠p s·ªë CCCD" required
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
        </div>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="nhk_ngayCap">Ng√†y c·∫•p *</label>
            <input id="nhk_ngayCap" type="date" class="input" required
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
          <div class="form__group">
            <label for="nhk_noiCap">N∆°i c·∫•p *</label>
            <input id="nhk_noiCap" type="text" class="input" placeholder="Nh·∫≠p n∆°i c·∫•p" required
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
        </div>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="nhk_noiSinh">N∆°i sinh *</label>
            <input id="nhk_noiSinh" type="text" class="input" placeholder="Nh·∫≠p n∆°i sinh" required
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
          <div class="form__group">
            <label for="nhk_nguonQuan">Nguy√™n qu√°n *</label>
            <input id="nhk_nguonQuan" type="text" class="input" placeholder="Nh·∫≠p nguy√™n qu√°n" required
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
        </div>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="nhk_ngheNghiep">Ngh·ªÅ nghi·ªáp *</label>
            <input id="nhk_ngheNghiep" type="text" class="input" placeholder="Nh·∫≠p ngh·ªÅ nghi·ªáp" required
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
          <div class="form__group">
            <label for="nhk_noiLamViec">N∆°i l√†m vi·ªác *</label>
            <input id="nhk_noiLamViec" type="text" class="input" placeholder="Nh·∫≠p n∆°i l√†m vi·ªác" required
              style="padding: 10px 12px; border-radius: 6px;" />
          </div>
        </div>

        <h3 style="font-size: 14px; margin: 16px 0 12px 0; font-weight: 600;">üè† Th√¥ng tin h·ªô kh·∫©u</h3>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="nhk_loaiHoKhau">Lo·∫°i h·ªô kh·∫©u *</label>
            <select id="nhk_loaiHoKhau" class="input" required style="padding: 10px 12px; border-radius: 6px;">
              <option value="">Ch·ªçn lo·∫°i h·ªô kh·∫©u</option>
              <option value="Th∆∞·ªùng tr√∫">Th∆∞·ªùng tr√∫</option>
              <option value="T·∫°m tr√∫">T·∫°m tr√∫</option>
            </select>
          </div>
        </div>

        <div id="tamTruFieldsContainer" class="form__row" style="gap: 16px; display: none;">
          <div class="form__group">
            <label for="nhk_tuNgayTamTru">T·ª´ ng√†y *</label>
            <input id="nhk_tuNgayTamTru" type="date" class="input" style="padding: 10px 12px; border-radius: 6px;" />
          </div>
          <div class="form__group">
            <label for="nhk_denNgayTamTru">ƒê·∫øn ng√†y *</label>
            <input id="nhk_denNgayTamTru" type="date" class="input" style="padding: 10px 12px; border-radius: 6px;" />
          </div>
        </div>
        <div class="form__row" style="gap: 16px; display: flex; flex-direction: column;">
          <div class="form__group" style="width: 100%;">
            <label for="nhk_diaChiTruoc">ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫ tr∆∞·ªõc ƒë√¢y *</label>
            <textarea id="nhk_diaChiTruoc" class="input" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ" required
              style="padding: 10px 12px; border-radius: 6px; min-height: 100px; resize: vertical;" rows="4"></textarea>
          </div>
        </div>
        <div class="form__group" style="width: 100%;">
          <label for="nhk_diaChi">ƒê·ªãa ch·ªâ h·ªô kh·∫©u hi·ªán t·∫°i *</label>
          <textarea id="nhk_diaChi" class="input" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ" required
            style="padding: 10px 12px; border-radius: 6px; min-height: 100px; resize: vertical;" rows="4"></textarea>
        </div>

        <div class="form__actions" style="display: flex; gap: 12px; margin-top: 24px; justify-content: flex-end;">
          <button type="button" id="cancelCreateBtn" class="btn"
            style="padding: 10px 24px; background: #f3f4f6; color: #374151; border-radius: 6px;">H·ªßy</button>
          <button type="submit" class="btn btn--primary" style="padding: 10px 24px; border-radius: 6px;">‚úì T·∫°o h·ªô
            kh·∫©u</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal: Edit Household -->
<div id="editHouseholdModal" class="modal">
  <div class="modal__overlay"></div>
  <div class="modal__content">
    <div class="modal__header">
      <h2>Ch·ªânh s·ª≠a h·ªô kh·∫©u</h2>
      <button id="closeEditModal" class="modal__close" aria-label="ƒê√≥ng">√ó</button>
    </div>
    <div class="modal__body">
      <form id="editHouseholdForm" class="form">
        <div class="form__group">
          <label for="edit_chuHo">Ch·ªß h·ªô *</label>
          <select id="edit_chuHo" class="input" required>
            <option value="">-- Ch·ªçn ch·ªß h·ªô --</option>
          </select>
        </div>
        <div class="form__group">
          <label for="edit_diaChi">ƒê·ªãa ch·ªâ *</label>
          <input id="edit_diaChi" type="text" class="input" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ" required />
        </div>

        <h3 style="font-size: 14px; margin: 16px 0 12px 0; font-weight: 600;">üë• Ch·ªçn l·∫°i quan h·ªá v·ªõi ch·ªß h·ªô m·ªõi</h3>
        <div id="editRelationContainer"
          style="background: #f8fafc; border-radius: 12px; padding: 12px; max-height: 200px; overflow-y: auto; margin-bottom: 16px;">
        </div>

        <div class="form__actions">
          <button type="submit" class="btn btn--primary">‚úì L∆∞u thay ƒë·ªïi</button>
          <button type="button" id="cancelEditBtn" class="btn">H·ªßy</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal: Split Household -->
<div id="splitHouseholdModal" class="modal">
  <div class="modal__overlay"></div>
  <div class="modal__content" style="max-width: 700px;">
    <div class="modal__header">
      <h2>T√°ch h·ªô kh·∫©u</h2>
      <button id="closeSplitModal" class="modal__close" aria-label="ƒê√≥ng">√ó</button>
    </div>
    <div class="modal__body" style="max-height: 70vh; overflow-y: auto;">
      <h3 style="font-size: 14px; margin: 0 0 12px 0; font-weight: 600;">üìã Danh s√°ch th√†nh vi√™n ƒë∆∞·ª£c ch·ªçn</h3>
      <div id="splitMemberList"
        style="background:#f8fafc;border-radius:12px;padding:12px;margin-bottom:16px;max-height:150px;overflow-y:auto;">
      </div>

      <form id="splitHouseholdForm" class="form">
        <h3 style="font-size: 14px; margin: 16px 0 12px 0; font-weight: 600;">üìã Th√¥ng tin h·ªô kh·∫©u m·ªõi</h3>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="split_chuHoMoi">Ch·ªß h·ªô m·ªõi *</label>
            <select id="split_chuHoMoi" class="input" required>
              <option value="">-- Ch·ªçn ch·ªß h·ªô m·ªõi --</option>
            </select>
            <input type="hidden" id="split_chuHoMoi_hidden" required />
          </div>
          <div class="form__group">
            <label for="split_diaChi">ƒê·ªãa ch·ªâ h·ªô kh·∫©u m·ªõi *</label>
            <input id="split_diaChi" type="text" class="input" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ h·ªô kh·∫©u m·ªõi" required />
          </div>
        </div>

        <h3 style="font-size: 14px; margin: 16px 0 12px 0; font-weight: 600;">üë• Ch·ªçn l·∫°i quan h·ªá v·ªõi ch·ªß h·ªô m·ªõi</h3>
        <div id="relationContainer"
          style="background: #f8fafc; border-radius: 12px; padding: 12px; max-height: 200px; overflow-y: auto;"></div>

        <div class="form__actions" style="display: flex; gap: 12px; margin-top: 24px; justify-content: flex-end;">
          <button type="button" id="cancelSplitBtn" class="btn"
            style="padding: 10px 24px; background: #f3f4f6; color: #374151; border-radius: 6px;">H·ªßy</button>
          <button type="submit" class="btn btn--primary" style="padding: 10px 24px; border-radius: 6px;">‚úì T√°ch
            h·ªô</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal: Add Member -->
<div id="addMemberModal" class="modal">
  <div class="modal__overlay"></div>
  <div class="modal__content" style="max-width: 700px;">
    <div class="modal__header">
      <h2>Th√™m th√†nh vi√™n m·ªõi</h2>
      <button id="closeAddMemberModal" class="modal__close" aria-label="ƒê√≥ng"
        style="pointer-events: auto; z-index: 10;">√ó</button>
    </div>
    <div class="modal__body">
      <form id="addMemberForm" class="form">
        <h3 style="font-size: 14px; margin: 16px 0 12px 0; font-weight: 600;">üìã Th√¥ng tin c∆° b·∫£n</h3>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="member_hoTen">H·ªç v√† t√™n *</label>
            <input id="member_hoTen" type="text" class="input" placeholder="Nh·∫≠p h·ªç v√† t√™n" required />
          </div>
          <div class="form__group">
            <label for="member_biDanh">B√≠ danh</label>
            <input id="member_biDanh" type="text" class="input" placeholder="Nh·∫≠p b√≠ danh" />
          </div>
        </div>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="member_ngaySinh">Ng√†y sinh *</label>
            <input id="member_ngaySinh" type="date" class="input" required />
          </div>
          <div class="form__group">
            <label for="member_danToc">D√¢n t·ªôc</label>
            <input id="member_danToc" type="text" class="input" placeholder="Nh·∫≠p d√¢n t·ªôc" />
          </div>
        </div>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="member_gioiTinh">Gi·ªõi t√≠nh *</label>
            <select id="member_gioiTinh" class="input" required>
              <option value="">Ch·ªçn gi·ªõi t√≠nh</option>
              <option value="Nam">Nam</option>
              <option value="N·ªØ">N·ªØ</option>
            </select>
          </div>
          <div class="form__group">
            <label for="member_quanHe">Quan h·ªá v·ªõi ch·ªß h·ªô *</label>
            <select id="member_quanHe" class="input" required>
              <option value="">Ch·ªçn quan h·ªá</option>
              <option value="Ch·ªß h·ªô">Ch·ªß h·ªô</option>
              <option value="V·ª£">V·ª£</option>
              <option value="Ch·ªìng">Ch·ªìng</option>
              <option value="Con">Con</option>
              <option value="M·∫π">M·∫π</option>
              <option value="Cha">Cha</option>
              <option value="Anh">Anh</option>
              <option value="Em">Em</option>
              <option value="Ch√°u">Ch√°u</option>
              <option value="Kh√°c">Kh√°c</option>
            </select>
          </div>
        </div>

        <h3 style="font-size: 14px; margin: 16px 0 12px 0; font-weight: 600;">üÜî Th√¥ng tin gi·∫•y t·ªù</h3>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="member_cccd">S·ªë CCCD/CMND</label>
            <input id="member_cccd" type="text" class="input" placeholder="Nh·∫≠p s·ªë CCCD/CMND" />
          </div>
          <div class="form__group">
            <label for="member_ngayCapCCCD">Ng√†y c·∫•p</label>
            <input id="member_ngayCapCCCD" type="date" class="input" />
          </div>
        </div>
        <div class="form__group">
          <label for="member_noiCapCCCD">N∆°i c·∫•p</label>
          <input id="member_noiCapCCCD" type="text" class="input" placeholder="Nh·∫≠p n∆°i c·∫•p CCCD/CMND" />
        </div>

        <h3 style="font-size: 14px; margin: 16px 0 12px 0; font-weight: 600;">üåç Th√¥ng tin c√° nh√¢n</h3>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="member_diaChiTruoc">Th∆∞·ªùng tr√∫ tr∆∞·ªõc ƒë√¢y</label>
            <input id="member_diaChiTruoc" type="text" class="input" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ th∆∞·ªùng tr√∫ tr∆∞·ªõc ƒë√¢y" />
          </div>
          <div class="form__group">
            <label for="member_noiSinh">N∆°i sinh</label>
            <input id="member_noiSinh" type="text" class="input" placeholder="Nh·∫≠p n∆°i sinh" />
          </div>
        </div>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="member_nguonQuan">Nguy√™n qu√°n</label>
            <input id="member_nguonQuan" type="text" class="input" placeholder="Nh·∫≠p nguy√™n qu√°n" />
          </div>
        </div>

        <h3 style="font-size: 14px; margin: 16px 0 12px 0; font-weight: 600;">üíº Th√¥ng tin vi·ªác l√†m</h3>
        <div class="form__row" style="gap: 16px;">
          <div class="form__group">
            <label for="member_ngheNghiep">Ngh·ªÅ nghi·ªáp</label>
            <input id="member_ngheNghiep" type="text" class="input" placeholder="Nh·∫≠p ngh·ªÅ nghi·ªáp" />
          </div>
          <div class="form__group">
            <label for="member_noiLamViec">N∆°i l√†m vi·ªác</label>
            <input id="member_noiLamViec" type="text" class="input" placeholder="Nh·∫≠p n∆°i l√†m vi·ªác" />
          </div>
        </div>

        <div class="form__actions" style="display: flex; gap: 12px; margin-top: 24px; justify-content: flex-end;">
          <button type="button" id="cancelAddMemberBtn" class="btn"
            style="padding: 10px 24px; background: #f3f4f6; color: #374151; border-radius: 6px;">H·ªßy</button>
          <button type="submit" class="btn btn--primary" style="padding: 10px 24px; border-radius: 6px;">‚úì Th√™m th√†nh
            vi√™n</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal: Remove Member with Reason -->
<div id="removeMemberReasonModal" class="modal">
  <div class="modal__overlay"></div>
  <div class="modal__content" style="max-width: 500px;">
    <div class="modal__header">
      <h2>X√≥a th√†nh vi√™n</h2>
      <button id="closeRemoveMemberReasonModal" class="modal__close" aria-label="ƒê√≥ng"
        style="pointer-events: auto; z-index: 10;">√ó</button>
    </div>
    <div class="modal__body">
      <form id="removeMemberReasonForm" class="form">
        <div class="form__group">
          <label for="removeMemberReason">Nh·∫≠p l√Ω do x√≥a *</label>
          <textarea id="removeMemberReason" class="input" placeholder="Nh·∫≠p l√Ω do x√≥a th√†nh vi√™n..." rows="4" required
            style="padding: 10px 12px; border-radius: 6px; font-family: inherit;"></textarea>
        </div>
        <div class="form__actions" style="display: flex; gap: 12px; margin-top: 24px; justify-content: flex-end;">
          <button type="button" id="cancelRemoveMemberReasonBtn" class="btn"
            style="padding: 10px 24px; background: #f3f4f6; color: #374151; border-radius: 6px;">H·ªßy</button>
          <button type="submit" class="btn btn--primary" style="padding: 10px 24px; border-radius: 6px;">‚úì X√≥a th√†nh
            vi√™n</button>
        </div>
      </form>
    </div>
  </div>
</div>